<div class="minds-messenger-messenger mdl-color--white mdl-shadow--2dp" >

  <div  class="mdl-card mdl-shadow--2dp minds-messenger-message"  *ngIf="!isSubscriber || !isSubscribed">
    <div class="mdl-card__supporting-text" [hidden]="isSubscribed">
      You are not subscribed to @{{user.username}}
    </div>
    <div class="mdl-card__supporting-text" [hidden]="isSubscriber">
      You can only chat with @{{user.username}} when they subscribe to you
    </div>
  </div>

  <div class="mdl-spinner mdl-js-spinner is-active" [mdl] [hidden]="!inProgress"></div>

  <div class="m-messenger-load-earlier" (click)="load()" [hidden]="!hasMoreData || inProgress">Load earlier messages</div>
  <div class="m-messenger-load-earlier"  [hidden]="!inProgress">Loading...</div>
  <div class="m-messenger-load-earlier" [hidden]="hasMoreData">We couldn't find any earlier messages</div>

  <div *ngFor="#message of messages; #i = index">
    <div class="mdl-card minds-messenger-message" *ngIf="message">
      <div class="minds-block">
        <div class="minds-avatar">
            <img src="{{minds.cdn_url}}/icon/{{message.owner_guid}}/small" class="mdl-shadow--2dp" alt={{message.ownerObj.username}} title={{message.ownerObj.username}}>
        </div>

        <div class="minds-body">
          <p *ngIf="message.message">{{message.message}}</p>
          <p *ngIf="!message.message" class="mdl-color-text--blue-grey-100">Could not decrypt message</p>
          <span class="minds-gatherings-message-time mdl-color-text--grey-500">{{message.time_created * 1000 | date:'shortTime'}} - {{message.time_created * 1000 | date:'longDate'}}</span>
          <i class="material-icons delete mdl-color-text--blue-grey-300" (click)="delete(message, i)">delete</i>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="mdl-card minds-gatherings-send mdl-shadow--2dp" *ngIf="ready && isSubscriber && isSubscribed">
  <textarea #message
    type="text"
    id="chatText"
    (keyup)="keyup($event)"
    placeholder="Enter your message here..."
    [autoGrow]
    rows="1"
   ></textarea>
  <button class="mdl-button mdl-js-button mdl-button--colored"
    [disabled]="isSending"
    (click)="send(message)"
    >
    Send
    <i class="material-icons">send</i>
  </button>
</div>

<div class="minds-messenger-typing mdl-color-text--blue-grey-300" [hidden]="!isTyping">
  <i class="material-icons">mode_edit</i> typing...
</div>
